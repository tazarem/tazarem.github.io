{
    "version": "https://jsonfeed.org/version/1",
    "title": "Coding Coconut • All posts by \"pm2\" tag",
    "description": "주니어 웹 프론트엔드/백엔드 개발자. \\n  공부하는 것도, 노는 것도 그만큼 좋아합니다. \\n 현 직장에서는 AWS Lambda 와 Typscript 를 접목한 서드파티 모듈 개발을 하고 있습니다.",
    "home_page_url": "https://coding-coconut.com",
    "items": [
        {
            "id": "https://coding-coconut.com/post/clgyf4wf6002p665odgfx6ydy/",
            "url": "https://coding-coconut.com/post/clgyf4wf6002p665odgfx6ydy/",
            "title": "pm2와 클러스터화",
            "date_published": "2022-05-20T07:51:12.000Z",
            "content_html": "<h2 id=\"클러스터화-가동-설정-및-디버깅\"><a href=\"#클러스터화-가동-설정-및-디버깅\" class=\"headerlink\" title=\"클러스터화 가동 설정 및 디버깅\"></a>클러스터화 가동 설정 및 디버깅</h2><p>Node.js의 루트 바로 아래에 있는 인덱스 파일들은 package.json 설정 등을 통하면 멀티스레드로 실행할 수 있다.</p>\n<blockquote>\n<p>package.json 파일 설정과 pm2를 이용하여 별개의 프로그램을 클러스터화 가동한다.</p>\n</blockquote>\n<h3 id=\"1-pm2-npm-모듈-글로벌-옵션으로-깔기-클러스터-작동-확인을-위한-도구\"><a href=\"#1-pm2-npm-모듈-글로벌-옵션으로-깔기-클러스터-작동-확인을-위한-도구\" class=\"headerlink\" title=\"1. pm2 npm 모듈 글로벌 옵션으로 깔기(클러스터 작동 확인을 위한 도구)\"></a>1. pm2 npm 모듈 글로벌 옵션으로 깔기(클러스터 작동 확인을 위한 도구)</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install pm2 -g</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-클러스터화-파일-작성\"><a href=\"#2-클러스터화-파일-작성\" class=\"headerlink\" title=\"2. 클러스터화 파일 작성\"></a>2. 클러스터화 파일 작성</h3><p>  각 클러스터의 dev 실행 명령어 지정 및 클러스터화 시동 명령어 지정(package.json)</p>\n<blockquote>\n<p>package.json 작성 예제. daum/blog/post는 각기 실행할 별개의 index.ts파일이라고 보면 됨.</p>\n</blockquote>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;scripts&quot;:&#123;</span><br><span class=\"line\">    &quot;start:cluster&quot;: &quot;pm2-runtime pm2.config.js&quot;,</span><br><span class=\"line\">    &quot;dev:post&quot;: &quot;nodemon --legacy-watch --watch ./ --exec &#x27;npx&#x27; ts-node -r tsconfig-paths/register ./src/post.ts&quot;,</span><br><span class=\"line\">    &quot;dev:blog&quot;: &quot;nodemon --legacy-watch --watch ./ --exec &#x27;npx&#x27; ts-node -r tsconfig-paths/register ./src/blog.ts&quot;,</span><br><span class=\"line\">    &quot;dev:daum&quot;: &quot;nodemon --legacy-watch --watch ./ --exec &#x27;npx&#x27; ts-node -r tsconfig-paths/register ./src/daum.ts&quot;,</span><br><span class=\"line\">    &quot;dev&quot;: &quot;npm run dev:blog &amp; npm run dev:daum &amp; npm run dev:post&quot;,</span><br><span class=\"line\">    &quot;build&quot;: &quot;tsc -p tsconfig.json &amp;&amp; tsc-alias&quot;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>pm2.config.js 작성 예제. 클러스터화를 할 설정파일들을 지정한다. 인스턴스 갯수만큼 생성이 됨.</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports=&#123;</span><br><span class=\"line\">    apps:[</span><br><span class=\"line\">        &#123; <span class=\"attr\">name</span>: <span class=\"string\">&quot;post&quot;</span>, <span class=\"attr\">script</span>: <span class=\"string\">&quot;./dist/post.js&quot;</span>, <span class=\"attr\">instances</span>: <span class=\"number\">1</span>, <span class=\"attr\">exec_mode</span>: <span class=\"string\">&quot;cluster&quot;</span> &#125;,</span><br><span class=\"line\">        &#123; <span class=\"attr\">name</span>: <span class=\"string\">&quot;blog&quot;</span>, <span class=\"attr\">script</span>: <span class=\"string\">&quot;./dist/blog.js&quot;</span>, <span class=\"attr\">instances</span>: <span class=\"number\">1</span>, <span class=\"attr\">exec_mode</span>: <span class=\"string\">&quot;cluster&quot;</span> &#125;,</span><br><span class=\"line\">        &#123; <span class=\"attr\">name</span>: <span class=\"string\">&quot;daum&quot;</span>, <span class=\"attr\">script</span>: <span class=\"string\">&quot;./dist/daum.js&quot;</span>, <span class=\"attr\">instances</span>: <span class=\"number\">1</span>, <span class=\"attr\">exec_mode</span>: <span class=\"string\">&quot;cluster&quot;</span> &#125;,</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-빌드하기\"><a href=\"#3-빌드하기\" class=\"headerlink\" title=\"3. 빌드하기\"></a>3. 빌드하기</h3><blockquote>\n<p>타입스크립트 파일들이 js로 빌드된다.</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-클러스터-가동\"><a href=\"#4-클러스터-가동\" class=\"headerlink\" title=\"4. 클러스터 가동\"></a>4. 클러스터 가동</h3><blockquote>\n<p>package.json에서 선제 명령어 설정을 해줘야 함</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run start:cluster</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-이후-디버깅은-pm2-에서-할-수-있음\"><a href=\"#5-이후-디버깅은-pm2-에서-할-수-있음\" class=\"headerlink\" title=\"5. 이후 디버깅은 pm2 에서 할 수 있음\"></a>5. 이후 디버깅은 pm2 에서 할 수 있음</h3><blockquote>\n<p>가동되고 있는 클러스터 확인</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pm2 list</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>클러스터 상세내역 확인(방향키로 조정)</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pm2 monit</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>클러스터 가동 취소</p>\n</blockquote>\n<p>npm run start:cluster 명령어를 쳤던 커맨드창 ctrl+c </p>\n<p>이렇게 취소하면 pm2 list 했을 때 생성되었던 클러스터들이 사라진 것을 볼 수 있다.</p>\n",
            "tags": [
                "pm2"
            ]
        }
    ]
}